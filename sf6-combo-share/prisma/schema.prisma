generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model attributes {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(50)
  description String?  @db.Text
  combos      combos[]
}

model characters {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(50)
  image       String?  @db.VarChar(255)
  description String?  @db.Text
  combos      combos[]
  moves       moves[]
  users       users[]
}

model combo_tags {
  combo_id Int
  tag_id   Int
  combos   combos @relation(fields: [combo_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "combo_tags_ibfk_1")
  tags     tags   @relation(fields: [tag_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "combo_tags_ibfk_2")

  @@id([combo_id, tag_id])
  @@index([tag_id], map: "tag_id")
}

model combos {
  id              Int               @id @default(autoincrement())
  parent_combo_id Int?
  user_id         Int
  character_id    Int
  starter_move_id Int
  condition_id    Int
  attribute_id    Int?
  play_style String?
  combo_text      String            @db.Text
  damage          Int?
  frame           Int?
  version         String?           @default("1.00") @db.VarChar(20)
  description     String?           @db.Text
  video_url       String?           @db.VarChar(255)
  created_at      DateTime?         @default(now()) @db.DateTime(0)
  combo_tags      combo_tags[]
  users           users             @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "combos_ibfk_1")
  characters      characters        @relation(fields: [character_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "combos_ibfk_2")
  moves           moves             @relation(fields: [starter_move_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "combos_ibfk_3")
  conditions      conditions        @relation(fields: [condition_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "combos_ibfk_4")
  attributes      attributes?       @relation(fields: [attribute_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "combos_ibfk_5")
  combos          combos?           @relation("combosTocombos", fields: [parent_combo_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "combos_ibfk_6")
  other_combos    combos[]          @relation("combosTocombos")
  comments        comments[]
  favorites       favorites[]
  ratings         ratings[]

  @@index([attribute_id], map: "attribute_id")
  @@index([character_id], map: "character_id")
  @@index([condition_id], map: "condition_id")
  @@index([parent_combo_id], map: "parent_combo_id")
  @@index([starter_move_id], map: "starter_move_id")
  @@index([user_id], map: "user_id")
}

model comments {
  id         Int       @id @default(autoincrement())
  combo_id   Int
  user_id    Int
  comment    String    @db.Text
  created_at DateTime? @default(now()) @db.DateTime(0)
  combos     combos    @relation(fields: [combo_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "comments_ibfk_1")
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "comments_ibfk_2")

  @@index([combo_id], map: "combo_id")
  @@index([user_id], map: "user_id")
}

model conditions {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(50)
  description String?  @db.Text
  combos      combos[]
}

model favorites {
  id         Int       @id @default(autoincrement())
  combo_id   Int
  user_id    Int
  created_at DateTime? @default(now()) @db.DateTime(0)
  combos     combos    @relation(fields: [combo_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "favorites_ibfk_1")
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "favorites_ibfk_2")

  @@unique([combo_id, user_id], map: "combo_id")
  @@index([user_id], map: "user_id")
}

model moves {
  id           Int         @id @default(autoincrement())
  character_id Int
  name         String      @db.VarChar(50)
  input        String?     @db.VarChar(50)
  type String? @default(dbgenerated("通常技"))
  combos       combos[]
  characters   characters  @relation(fields: [character_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "moves_ibfk_1")

  @@index([character_id], map: "character_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model ratings {
  id         Int       @id @default(autoincrement())
  combo_id   Int
  user_id    Int
  value      Int       @db.TinyInt
  created_at DateTime? @default(now()) @db.DateTime(0)
  combos     combos    @relation(fields: [combo_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "ratings_ibfk_1")
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "ratings_ibfk_2")

  @@unique([combo_id, user_id], map: "combo_id")
  @@index([user_id], map: "user_id")
}

model tags {
  id          Int          @id @default(autoincrement())
  name        String       @db.VarChar(50)
  description String?      @db.Text
  combo_tags  combo_tags[]
}

model users {
  id                Int               @id @default(autoincrement())
  name              String            @db.VarChar(50)
  email             String            @unique(map: "email") @db.VarChar(100)
  password          String            @db.VarChar(255)
  play_style String? @default(dbgenerated("モダン"))
  main_character_id Int?
  profile           String?           @db.Text
  created_at        DateTime?         @default(now()) @db.DateTime(0)
  combos            combos[]
  comments          comments[]
  favorites         favorites[]
  ratings           ratings[]
  characters        characters?       @relation(fields: [main_character_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "users_ibfk_1")

  @@index([main_character_id], map: "main_character_id")
}

